<wxs src="../../wxs/utils.wxs" module="utils" />

<view class='wrapper'>
    <view class='list-warpper'>
    <search
        placeholder="关键字/位置/景点"
        value="{{keywords}}"
        bind:input="input"
        bind:confirm="confirm"
        bind:clean="clean"
        focus="{{ true }}"
    />
    <scroll-view class="keyword-scroll" scroll-y="true">
        <view class="tags-container" wx:if="{{ !isHasSearch }}">
            <tag-list 
                class="top" 
                loadingText="{{ getCurrnetCityText }}"
                loading="{{ currnetCityLoading }}" 
                title="当前" 
                list="{{currentCity}}" 
                bind:getTag="selectCity"
            >
                <view slot="right" bindtap="goToMoreCity">更多城市</view>
            </tag-list>
            <tag-list title="搜索记录" list="{{searchLogs}}" bind:getTag="searchTag" wx:if="{{!searchLogs || searchLogs.length >0}}">
                <view slot="right" bindtap="clearStorage">清除</view>
            </tag-list>
            <tag-list
                wx:if="{{ item.prodCustomTagList.length > 0 }}"
                wx:for="{{ tagList }}"
                wx:key="{{ item.categoryId }}"
                title="{{ item.categoryName }}"
                list="{{ item.prodCustomTagList }}"
                bind:getTag="clickTag"
            />
        </view>
        <block wx:else>
            <view wx:if="{{ loading }}" class="weui-loadmore">
                <view class="weui-loading"></view>
                <view class="weui-loadmore__tips">正在加载</view>
            </view>
            <block wx:else>
                <view class='keywords-result-container'>
                    <block wx:if="{{searchInfo.length > 0}}">
                        <view class='title'>位置<text class="see-all" catchtap="showMoreSearchCount">{{ showSearchCount === 10 ? '收起' : '更多' }}</text></view>
                        <view 
                            class="weui-media-box weui-media-box_appmsg" 
                            hover-class="weui-cell_active"
                            wx:for="{{searchInfo}}"
                            wx:if="{{ index < showSearchCount }}"
                            wx:key="index"
                            catch:tap="clickLocation"
                            data-item="{{ item.name }}"
                            data-adcode="{{ item.adcode }}"
                            data-location="{{ item.location }}"
                            data-district="{{ item.district }}"
                            data-typecode="{{ item.typecode }}"
                        >
                            <view class="weui-media-box__bd weui-media-box__bd_in-appmsg">
                                <view
                                    class="weui-media-box__title"
                                >
                                    {{item.name}}
                                </view>
                                <view class="weui-media-box__desc">
                                  <block wx:if="{{ item.district && !utils.isObject(item.district)}}">{{item.district}}</block>
                                  <block wx:if="{{ item.address && !utils.isObject(item.address)}}"> | {{item.address}}</block>
                                </view>
                            </view>
                        </view>
                    </block>
                </view>
                <view class='house-list-container'>
                    <block wx:if="{{ houseList.length > 0}}">
                        <view class='title'>民宿<text wx:if="{{ houseTotal > 10 }}" class="see-all" catchtap="showAllHouses">查看全部{{ houseTotal > 300 ? '300+' : houseTotal }}</text></view>
                        <view 
                            class="weui-media-box weui-media-box_appmsg" 
                            hover-class="weui-cell_active"
                            wx:for="{{houseList}}"
                            wx:key="id"
                            catch:tap="clickHouse"
                            data-item="{{ item }}"
                        >
                            <view class="weui-media-box__bd weui-media-box__bd_in-appmsg">
                                <view
                                    class="weui-media-box__title"
                                >
                                    <rich-text type="text" nodes="{{ item.highlight.title || item.title }}" />
                                </view>
                                <view class="weui-media-box__desc"><text class="address">{{ item.address }}</text> <text class="money">￥{{ item.standardPrice }}</text></view>
                            </view>
                        </view>
                    </block>
                </view>
            </block>
            <block wx:if="{{ !searchInfo.length && !houseList.length }}">
                <view class="error-container">
                    <view class="empty-house-list">
                        <icon class="icon-error" />
                        <text>没找到相关结果,换个词试试吧~</text>
                    </view>
                </view>
            </block>
        </block>
    </scroll-view>
    </view>
</view>
<im-message
    id="im-message"
    noAttached='{{false}}'
/>